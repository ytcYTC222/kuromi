<!-- å•†å“è¯¦æƒ…é¡µ -->
<scroll-view class="page-scroll" scroll-y="true" style="height: 100vh;">
  <view class="page-container">
    
    <!-- å•†å“å›¾ç‰‡è½®æ’­ -->
    <view class="product-gallery">
      <swiper class="product-swiper" indicator-dots="{{productImages.length > 1}}" autoplay="false" circular="true">
        <block wx:for="{{productImages}}" wx:key="index">
          <swiper-item>
            <image 
              src="{{item}}" 
              class="product-image" 
              mode="aspectFill" 
              bindtap="previewImages" 
              data-current="{{item}}"
              lazy-load="true" 
            />
          </swiper-item>
        </block>
      </swiper>
      
      <!-- å›¾ç‰‡æŒ‡ç¤ºå™¨ -->
      <view class="image-indicator" wx:if="{{productImages.length > 1}}">
        {{currentImageIndex + 1}} / {{productImages.length}}
      </view>
    </view>

    <!-- å•†å“åŸºæœ¬ä¿¡æ¯ -->
    <!-- äº§å“ä¿¡æ¯ä¸»å®¹å™¨ -->
    <view class="product-info">
      <!-- äº§å“æ ‡é¢˜åŒºåŸŸ -->
      <view class="product-header">
        <view class="title-container">
          <view class="product-title">{{productDetail.title}}</view>
          <view class="title-decoration"></view>
        </view>
        <view class="product-actions">
          <!-- æ”¶è—æŒ‰é’® -->
          <view class="action-item favorite-btn" bindtap="toggleFavorite">
            <view class="action-icon">
              <text class="{{productDetail.isFavorite ? 'icon-heart' : 'icon-heart-o'}}"></text>
            </view>
            <view class="action-label">æ”¶è—</view>
          </view>
          <!-- åˆ†äº«æŒ‰é’® -->
          <button class="action-item share-btn" open-type="share">
            <view class="action-icon">
              <text class="icon-share"></text>
            </view>
            <view class="action-label">åˆ†äº«</view>
          </button>
        </view>
      </view>
      
      <!-- ä»·æ ¼ä¿¡æ¯å®¹å™¨ -->
      <view class="price-container">
        <view class="price-main">
          <view class="price-symbol">Â¥</view>
          <view class="current-price">{{productDetail.currentPrice}}</view>
          <view class="price-unit">èµ·</view>
        </view>
        <view class="price-details">
          <view class="original-price" wx:if="{{productDetail.originalPrice && productDetail.originalPrice > productDetail.currentPrice}}">
            åŸä»· Â¥{{productDetail.originalPrice}}
          </view>
          <view class="discount-badge" wx:if="{{productDetail.discountText}}">
            <view class="badge-icon">ğŸ”¥</view>
            <view class="badge-text">{{productDetail.discountText}}</view>
          </view>
        </view>
      </view>
      
      <!-- è¯„åˆ†å’Œé”€é‡ä¿¡æ¯ -->
      <view class="stats-container">
        <!-- è¯„åˆ†åŒºåŸŸ -->
        <view class="rating-container">
          <view class="rating-content">
            <view class="rating-stars">
              <block wx:for="{{5}}" wx:key="*this" wx:for-item="star">
                <text class="star-icon {{star < productDetail.rating ? 'star-filled' : (star === Math.floor(productDetail.rating) && productDetail.rating % 1 !== 0 ? 'star-half' : 'star-empty')}}"></text>
              </block>
            </view>
            <view class="rating-info">
              <view class="rating-score">{{productDetail.rating}}</view>
              <view class="rating-count">({{productDetail.ratingCount}}æ¡è¯„ä»·)</view>
            </view>
          </view>
        </view>
        
        <!-- é”€é‡åŒºåŸŸ -->
        <view class="sales-container">
          <view class="sales-content">
            <view class="sales-icon">ğŸ“ˆ</view>
            <view class="sales-info">
              <view class="sales-number">{{productDetail.salesCount || 0}}</view>
              <view class="sales-label">ä»¶å·²å”®</view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- å•†å“è§„æ ¼é€‰æ‹© -->
    <view class="spec-section" wx:if="{{productDetail.specifications && productDetail.specifications.length > 0}}">
      <view class="section-title">é€‰æ‹©è§„æ ¼</view>
      <block wx:for="{{productDetail.specifications}}" wx:key="name" wx:for-item="spec">
        <view class="spec-group">
          <view class="spec-name">{{spec.name}}</view>
          <view class="spec-options">
            <block wx:for="{{spec.options}}" wx:key="value" wx:for-item="option">
              <view 
                class="spec-option {{selectedSpecs[spec.name] === option.value ? 'selected' : ''}}" 
                bindtap="selectSpec" 
                data-spec-name="{{spec.name}}" 
                data-spec-value="{{option.value}}"
              >
                {{option.label}}
              </view>
            </block>
          </view>
        </view>
      </block>
    </view>

    <!-- æ•°é‡é€‰æ‹© -->
    <view class="quantity-section">
      <view class="section-title">è´­ä¹°æ•°é‡</view>
      <view class="quantity-selector">
        <view class="quantity-btn" bindtap="decreaseQuantity">
          <text class="icon-minus"></text>
        </view>
        <input class="quantity-input" type="number" value="{{quantity}}" bindinput="onQuantityInput" />
        <view class="quantity-btn" bindtap="increaseQuantity">
          <text class="icon-plus"></text>
        </view>
      </view>
      <view class="stock-info">åº“å­˜{{productDetail.stock || 0}}ä»¶</view>
    </view>



    <!-- å•†å“è¯¦æƒ…æè¿° -->
    <view class="description-section">
      <view class="section-title">å•†å“è¯¦æƒ…</view>
      <view class="description-content">
        <text class="description-text">{{productDetail.description}}</text>
        
        <!-- å•†å“è¯¦æƒ…å›¾ç‰‡ -->
        <view class="detail-images" wx:if="{{productDetail.detailImages && productDetail.detailImages.length > 0}}">
          <block wx:for="{{productDetail.detailImages}}" wx:key="index">
            <image 
              src="{{item}}" 
              class="detail-image" 
              mode="widthFix" 
              lazy-load="true"
              bindtap="previewDetailImages"
              data-current="{{item}}"
            />
          </block>
        </view>
      </view>
    </view>

    <!-- å•†å“å‚æ•° -->
    <view class="params-section" wx:if="{{productDetail.parameters && productDetail.parameters.length > 0}}">
      <view class="section-title">å•†å“å‚æ•°</view>
      <view class="params-list">
        <block wx:for="{{productDetail.parameters}}" wx:key="name">
          <view class="param-item">
            <view class="param-name">{{item.name}}</view>
            <view class="param-value">{{item.value}}</view>
          </view>
        </block>
      </view>
    </view>

    <!-- ç”¨æˆ·è¯„ä»· -->
    <view class="reviews-section" wx:if="{{productDetail.reviews && productDetail.reviews.length > 0}}">
      <view class="section-title">ç”¨æˆ·è¯„ä»·</view>
      <view class="reviews-list">
        <block wx:for="{{productDetail.reviews}}" wx:key="id" wx:for-item="review">
          <view class="review-item">
            <view class="review-header">
              <view class="reviewer-info">
                <image src="{{review.avatar || '/img/default-avatar.png'}}" class="reviewer-avatar" />
                <view class="reviewer-name">{{review.username}}</view>
              </view>
              <view class="review-rating">
                <block wx:for="{{5}}" wx:key="*this" wx:for-item="star">
                  <text class="{{star < review.rating ? 'icon-star' : 'icon-star-o'}}"></text>
                </block>
              </view>
            </view>
            <view class="review-content">{{review.content}}</view>
            <view class="review-time">{{review.createTime}}</view>
          </view>
        </block>
      </view>
    </view>

    <!-- åº•éƒ¨å ä½ï¼Œé¿å…è¢«åº•éƒ¨æ“ä½œæ é®æŒ¡ -->
    <view class="bottom-placeholder"></view>
  </view>
</scroll-view>

<!-- åº•éƒ¨æ“ä½œæ  -->
<view class="bottom-actions">
  <view class="action-group">
    <!-- å®¢æœæŒ‰é’® -->
    <button class="action-item" open-type="contact">
      <text class="icon-service"></text>
      <text class="action-text">å®¢æœ</text>
    </button>
    
    <!-- è´­ç‰©è½¦æŒ‰é’® -->
    <!-- <navigator url="/pages/cart/cart" class="action-item">
      <text class="icon-shopping-cart"></text>
      <text class="action-text">è´­ç‰©è½¦</text>
      <view class="cart-badge" wx:if="{{cartCount > 0}}">{{cartCount}}</view>
    </navigator> -->
  </view>
  
  <view class="purchase-group-fixed">
    <!-- åŠ å…¥è´­ç‰©è½¦æŒ‰é’® -->
    <button class="add-cart-btn-fixed" bindtap="addToCart">
      <text class="icon-shopping-cart"></text>
      åŠ å…¥è´­ç‰©è½¦
    </button>
    
    <!-- ç«‹å³è´­ä¹°æŒ‰é’® -->
    <button class="buy-now-btn-fixed" bindtap="buyNow">
      <text class="icon-flash"></text>
      ç«‹å³è´­ä¹°
    </button>
  </view>
</view>

<!-- åŠ è½½çŠ¶æ€ -->
<view class="loading-container" wx:if="{{loading}}">
  <view class="loading-spinner"></view>
  <text class="loading-text">åŠ è½½ä¸­...</text>
</view>